
SELECT
	STAFF_ID,
	AVG(TOTAL)
FROM
	(
		SELECT
			S.STAFF_ID,
			C.CUSTOMER_ID,
			SUM(AMOUNT) AS TOTAL
		FROM
			PAYMENT P
			INNER JOIN STAFF S ON P.STAFF_ID = S.STAFF_ID
			INNER JOIN CUSTOMER C ON C.CUSTOMER_ID = P.CUSTOMER_ID
		GROUP BY
			S.STAFF_ID,
			C.CUSTOMER_ID
		ORDER BY
			2
	)
GROUP BY
	STAFF_ID
